# Kapital Sheet Urgut Bot

Telegram бот для управления финансовыми операциями с интеграцией в Google Sheets.

## Изменения в новой версии

Бот был обновлен для работы с новым Google Sheet, который имеет следующую структуру:

| Столбец | Название | Описание |
|---------|----------|----------|
| A | Сана | Дата в формате DD.MM.YYYY |
| B | Кирим | Сумма дохода |
| C | Чиқим | Сумма расхода |
| D | остатка | Остаток (не используется) |
| E | Котегория | Категория операции |
| F | Изох | Комментарий к операции |
| G | Объект номи | Название объекта/проекта |

## Процесс работы бота

1. **Выбор типа операции**: Пользователь выбирает между "Kirim" (доход) и "Chiqim" (расход)
2. **Ввод суммы**: Пользователь вводит сумму операции
3. **Выбор категории**: Пользователь выбирает категорию из списка
4. **Ввод комментария**: Пользователь вводит комментарий или пропускает
5. **Ввод объекта**: Пользователь вводит название объекта/проекта
6. **Подтверждение**: Пользователь подтверждает данные перед отправкой

## Команды бота

- `/start` - Начать новую операцию
- `/register` - Регистрация нового пользователя
- `/test_sheets` - Проверить подключение к Google Sheets (только для админов)
- `/add_category` - Добавить новую категорию (только для админов)
- `/del_category` - Удалить категорию (только для админов)
- `/edit_category` - Редактировать категорию (только для админов)
- `/userslist` - Список пользователей (только для админов)
- `/block_user` - Заблокировать пользователя (только для админов)
- `/approve_user` - Одобрить пользователя (только для админов)

## Настройка

1. Создайте файл `.env` с переменными окружения:
```env
BOT_TOKEN=your_telegram_bot_token
POSTGRES_DB=kapital
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
```

2. Убедитесь, что у вас есть файл `credentials.json` для доступа к Google Sheets API

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Запустите бота:
```bash
python bot.py
```

## Особенности

- Автоматическое определение столбцов Кирим/Чиқим в зависимости от типа операции
- Автоматическое заполнение даты в формате DD.MM.YYYY
- Система одобрения пользователей администраторами
- Управление категориями через админ-панель
- Интеграция с PostgreSQL
- Уведомления администраторов о новых операциях

## Структура базы данных

### Таблица users
- id: SERIAL PRIMARY KEY
- user_id: BIGINT UNIQUE (Telegram ID пользователя)
- name: TEXT (Имя пользователя)
- phone: TEXT (Номер телефона)
- status: TEXT (Статус: pending, approved, blocked, denied)
- reg_date: TEXT (Дата регистрации)

### Таблица categories
- id: SERIAL PRIMARY KEY
- name: TEXT UNIQUE (Название категории)
